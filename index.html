<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Tag</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --text-main: #2c3e50;
            --text-sub: #7f8c8d;
            --card-radius: 20px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --accent: #3498db;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 60px; 
        }

        /* --- é¡¶éƒ¨æ  --- */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(244, 246, 248, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            border-bottom: 2px solid transparent;
            transition: border-color 0.3s;
            cursor: text;
            min-width: 100px;
        }
        h1:focus { border-bottom-color: var(--accent); }

        .add-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            box-shadow: var(--shadow);
            border: none;
            font-size: 24px;
            color: var(--text-main);
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .add-btn:active { transform: scale(0.9); }
        .add-btn:hover { background: var(--accent); color: white; }

        /* --- ä¸­é—´ç¼–è¾‘åŒº --- */
        main {
            flex: 1;
            padding: 20px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            grid-auto-rows: 160px;
            gap: 20px;
            min-height: calc(100vh + 80px); 
        }

        /* --- å¡ç‰‡é€šç”¨æ ·å¼ --- */
        .card {
            background: #fff;
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            user-select: none;
            /* å…³é”®ï¼šå…è®¸ç‚¹å‡» */
            cursor: pointer; 
        }
        .card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card:active { transform: scale(0.98); }
        
        /* é˜²æ­¢åˆ é™¤æŒ‰é’®è§¦å‘å¡ç‰‡ç‚¹å‡» */
        .card .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            cursor: pointer;
            font-size: 14px;
            color: #e74c3c;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            z-index: 10;
        }
        .card:hover .delete-btn { opacity: 1; }

        /* å¸ƒå±€å˜ä½“ */
        .card.span-2 { grid-column: span 2; }
        .card.span-2-2 { grid-column: span 2; grid-row: span 2; }

        /* ç±»å‹æ ·å¼ */
        .card-time {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            justify-content: center;
            align-items: center;
            cursor: move; /* æ—¶é—´é€šå¸¸ä¸éœ€è¦ç¼–è¾‘ */
        }
        .time-display { font-size: 2.5rem; font-weight: 700; letter-spacing: 1px; pointer-events: none;}
        .date-display { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; pointer-events: none;}

        .card-tag { background: #fffbe7; border-left: 5px solid #f1c40f; }
        .card-tag p { font-size: 1rem; color: #555; word-break: break-all; pointer-events: none;}

        .card-hw { background: #e8f6f3; border-top: 5px solid #1abc9c; }
        .card-hw .subject { font-size: 0.85rem; color: #16a085; font-weight: 700; text-transform: uppercase; margin-bottom: 8px; pointer-events: none;}
        .card-hw .content { font-size: 1.1rem; color: #333; flex: 1; overflow-y: auto; pointer-events: none;}
        .card-hw.span-2-2 .content { font-size: 1.2rem; line-height: 1.6; }

        /* --- é¡µè„š --- */
        footer {
            text-align: center;
            padding: 40px 0 20px;
            color: var(--text-sub);
            font-size: 0.8rem;
            opacity: 0.6;
            margin-top: auto; 
        }

        /* --- å¼¹çª— --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal {
            background: white;
            padding: 30px;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal h3 { margin-bottom: 20px; color: var(--text-main); }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .modal-btn {
            padding: 12px;
            border: 2px solid #eee;
            background: #fff;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-sub);
        }
        .modal-btn.active { border-color: var(--accent); color: var(--accent); background: #f0f8ff; }
        
        .input-group { margin-bottom: 20px; display: none; }
        .input-group.show { display: block; }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            margin-top: 5px;
            font-size: 1rem;
            font-family: inherit;
        }
        textarea { resize: vertical; min-height: 80px; }
        
        .action-btn {
            width: 100%;
            padding: 12px;
            background: var(--text-main);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            main { grid-template-columns: 1fr 1fr; } 
            .card.span-2 { grid-column: span 2; }
            .card-time { grid-column: span 2; }
        }
    </style>
</head>
<body>

    <header>
        <!-- æ·»åŠ IDä»¥ä¾¿ä¿å­˜ -->
        <h1 id="page-title" contenteditable="true">é«˜ä¸‰8ç­</h1>
        <button class="add-btn" onclick="openAddModal()">+</button>
    </header>

    <main id="card-container">
        <!-- å¡ç‰‡å°†é€šè¿‡JSåŠ è½½ -->
    </main>

    <footer id="footer">
        <p>&copy; 2025 Class Tag. All rights reserved.</p>
        <p>ç»´æŠ¤å›¢é˜Ÿ: å°ç›’å­å›¢é˜Ÿ <a href="https://github.com/shunianssy/ClassTap">Github</a></p>
    </footer>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <h3 id="modal-title">æ·»åŠ æ–°å¡ç‰‡</h3>
            
            <!-- ç±»å‹é€‰æ‹©å™¨ (ç¼–è¾‘æ¨¡å¼ä¸‹éšè—) -->
            <div class="btn-group" id="type-selector">
                <button class="modal-btn active" onclick="selectType('hw')">ğŸ“š ä½œä¸š</button>
                <button class="modal-btn" onclick="selectType('tag')">ğŸ“Œ æ ‡ç­¾</button>
                <button class="modal-btn" onclick="selectType('time')">â° æ—¶é—´</button>
            </div>

            <div id="input-hw" class="input-group show">
                <input type="text" id="hw-subject" placeholder="å­¦ç§‘ (å¦‚: æ•°å­¦)">
                <textarea id="hw-content" placeholder="ä½œä¸šå†…å®¹..."></textarea>
            </div>

            <div id="input-tag" class="input-group">
                <textarea id="tag-content" placeholder="å¤‡æ³¨å†…å®¹..."></textarea>
            </div>

            <div id="input-time" class="input-group">
                <p style="color:#888; text-align:center;">æ˜¾ç¤ºå½“å‰æ—¶é—´ã€‚</p>
            </div>

            <button class="action-btn" id="confirm-btn" onclick="confirmAction()">ç¡®è®¤æ·»åŠ </button>
            <button class="action-btn" style="background:transparent; color:#999; margin-top:10px;" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        // --- å…¨å±€çŠ¶æ€ ---
        const container = document.getElementById('card-container');
        const modal = document.getElementById('modal');
        const titleElem = document.getElementById('page-title');
        let editingCardElement = null; // å½“å‰æ­£åœ¨ç¼–è¾‘çš„å¡ç‰‡DOMå…ƒç´ ï¼Œå¦‚æœä¸ºnullåˆ™æ˜¯æ–°å¢æ¨¡å¼
        let currentType = 'hw';

        // --- 1. åˆå§‹åŒ–ä¸æ•°æ®åŠ è½½ ---
        window.onload = function() {
            loadData();
            // æ ‡é¢˜å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜
            titleElem.addEventListener('blur', saveData);
            // å®æ—¶æ—¶é’Ÿ
            setInterval(updateTimeDisplays, 1000);
            updateTimeDisplays();
        };

        // SortableJS åˆå§‹åŒ– (æ‹–æ‹½)
        new Sortable(container, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            delay: 200, 
            delayOnTouchOnly: true,
            filter: '.delete-btn', // è¿‡æ»¤å™¨ï¼Œé˜²æ­¢æ‹–æ‹½åˆ é™¤æŒ‰é’®
            onEnd: function() {
                saveData(); // æ‹–æ‹½ç»“æŸåä¿å­˜é¡ºåº
            }
        });

        // --- 2. æ ¸å¿ƒæ•°æ®ä¿å­˜/è¯»å–é€»è¾‘ ---
        
        // ä¿å­˜æ‰€æœ‰æ•°æ®åˆ° LocalStorage
        function saveData() {
            const cards = [];
            // éå† DOM èŠ‚ç‚¹è·å–æ•°æ®ï¼Œä¿è¯é¡ºåºä¸ç•Œé¢ä¸€è‡´
            Array.from(container.children).forEach(card => {
                cards.push({
                    type: card.dataset.type,
                    subject: card.dataset.subject || "",
                    content: card.dataset.content || ""
                });
            });

            const data = {
                title: titleElem.innerText,
                cards: cards
            };

            localStorage.setItem('classBoardData', JSON.stringify(data));
        }

        // ä» LocalStorage åŠ è½½æ•°æ®
        function loadData() {
            const raw = localStorage.getItem('classBoardData');
            if (!raw) {
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ‰“å¼€ï¼ŒåŠ è½½é»˜è®¤æ•°æ®
                renderCard('time', '', '');
                renderCard('tag', '', 'æ¬¢è¿ä½¿ç”¨ï¼ç‚¹å‡»å¡ç‰‡å¯ä»¥ç¼–è¾‘ï¼Œé•¿æŒ‰å¯ä»¥æ‹–åŠ¨æ’åºã€‚');
                return;
            }

            const data = JSON.parse(raw);
            if(data.title) titleElem.innerText = data.title;
            
            // æ¸…ç©ºç°æœ‰å®¹å™¨
            container.innerHTML = '';
            
            // é‡å»ºå¡ç‰‡
            if(data.cards && data.cards.length > 0) {
                data.cards.forEach(item => {
                    renderCard(item.type, item.subject, item.content);
                });
            }
        }

        // --- 3. æ¸²æŸ“ä¸DOMæ“ä½œ ---

        // åœ¨ç•Œé¢ä¸Šåˆ›å»ºä¸€ä¸ªå¡ç‰‡DOM
        function renderCard(type, subject, content) {
            const div = document.createElement('div');
            let classes = 'card';
            let innerHTML = '';

            // è®¾ç½®æ•°æ®å±æ€§ï¼Œæ–¹ä¾¿åç»­è¯»å–å’Œä¿å­˜
            div.dataset.type = type;
            div.dataset.subject = subject;
            div.dataset.content = content;

            // ç‚¹å‡»äº‹ä»¶ï¼šç‚¹å‡»å¡ç‰‡æœ¬èº«è§¦å‘ç¼–è¾‘
            div.onclick = function(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯åˆ é™¤æŒ‰é’®ï¼Œä¸è§¦å‘ç¼–è¾‘
                if(e.target.classList.contains('delete-btn')) return;
                openEditModal(div);
            };

            if (type === 'time') {
                classes += ' card-time span-2';
                // æ—¶é—´å¡ç‰‡é€šå¸¸ä¸éœ€è¦ç¼–è¾‘æ–‡æœ¬ï¼Œå¯ä»¥ç¦ç”¨ç‚¹å‡»ç¼–è¾‘
                div.onclick = null; 
                div.style.cursor = 'move';
                innerHTML = `
                    <div class="time-display">--:--</div>
                    <div class="date-display">...</div>
                    <span class="delete-btn" onclick="removeCard(this)">âœ•</span>
                `;
            } else if (type === 'tag') {
                classes += ' card-tag';
                innerHTML = `
                    <p>${content}</p>
                    <span class="delete-btn" onclick="removeCard(this)">âœ•</span>
                `;
            } else if (type === 'hw') {
                classes += ' card-hw';
                // æ™ºèƒ½åˆ¤æ–­å¤§å°
                if (content.length > 50 || content.includes('\n')) {
                    classes += ' span-2-2';
                }
                innerHTML = `
                    <div class="subject">${subject}</div>
                    <div class="content">${content.replace(/\n/g, '<br>')}</div>
                    <span class="delete-btn" onclick="removeCard(this)">âœ•</span>
                `;
            }

            div.className = classes;
            div.innerHTML = innerHTML;
            container.insertBefore(div, container.firstChild); // é»˜è®¤æ’å…¥æœ€å‰é¢
            
            // å¦‚æœæ˜¯åŠ è½½æ•°æ®é‡å»ºDOMï¼Œå¯èƒ½éœ€è¦ä¿æŒåŸé¡ºåºï¼Œè¿™é‡Œç®€å•å¤„ç†æ’å…¥å‰é¢
            // å®é™… loadData ä¸­æ˜¯æŒ‰é¡ºåºéå†çš„ï¼Œæ‰€ä»¥ç”¨ appendChild æ›´å¥½ï¼Œä½†ä¸ºäº†æ–°å¢æ–¹ä¾¿ç”¨ insertBefore
            // ä¿®æ­£ï¼šloadData å¾ªç¯é‡Œåº”è¯¥ç”¨ appendï¼Œè¿™é‡Œä¸ºäº†å¤ç”¨å‡½æ•°ï¼Œæˆ‘ä»¬ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹é€»è¾‘
            // *åœ¨ loadData å¾ªç¯ä¸­è°ƒç”¨æ—¶ï¼Œå…¶å®å€’åºæ¸²æŸ“æˆ–è€…æ”¹æˆ append éƒ½å¯ä»¥ã€‚
            // ç®€å•ä¿®æ­£ï¼šå¦‚æœæ˜¯æ–°å¢(UIè§¦å‘)æ’å‰é¢ï¼Œå¦‚æœæ˜¯Load(ç³»ç»Ÿè§¦å‘)æ’åé¢ï¼Ÿ
            // ç®€åŒ–æ–¹æ¡ˆï¼šç»Ÿä¸€æ’å‰é¢ï¼ŒloadData æ—¶æˆ‘ä»¬å°†æ•°ç»„ reverse ä¸€ä¸‹å†éå†å³å¯ï¼Œæˆ–è€…ç›´æ¥æ”¹ä¸º appendChild
        }
        
        // ä¸ºäº†ä¿®æ­£ä¸Šé¢çš„é¡ºåºé—®é¢˜ï¼Œæˆ‘ä»¬é‡å†™ renderCard çš„æ’å…¥é€»è¾‘
        // ä¿®æ”¹ç‰ˆ renderCard
        function renderCard(type, subject, content, appendToEnd = false) {
            const div = document.createElement('div');
            // ... (å‰é¢çš„é€»è¾‘ä¸€è‡´) ...
            
            // é‡å¤å‰é¢çš„æ„å»ºé€»è¾‘
            let classes = 'card';
            let innerHTML = '';
            div.dataset.type = type;
            div.dataset.subject = subject;
            div.dataset.content = content;

            div.onclick = function(e) {
                if(e.target.classList.contains('delete-btn')) return;
                openEditModal(div);
            };

            if (type === 'time') {
                classes += ' card-time span-2';
                div.onclick = null; 
                div.style.cursor = 'move';
                innerHTML = `<div class="time-display">--:--</div><div class="date-display">...</div><span class="delete-btn" onclick="removeCard(this)">âœ•</span>`;
            } else if (type === 'tag') {
                classes += ' card-tag';
                innerHTML = `<p>${content}</p><span class="delete-btn" onclick="removeCard(this)">âœ•</span>`;
            } else if (type === 'hw') {
                classes += ' card-hw';
                if (content.length > 50 || content.includes('\n')) classes += ' span-2-2';
                innerHTML = `<div class="subject">${subject}</div><div class="content">${content.replace(/\n/g, '<br>')}</div><span class="delete-btn" onclick="removeCard(this)">âœ•</span>`;
            }

            div.className = classes;
            div.innerHTML = innerHTML;

            if(appendToEnd) {
                container.appendChild(div);
            } else {
                container.insertBefore(div, container.firstChild);
            }
            if(type === 'time') updateTimeDisplays();
        }

        // è¦†ç›– loadData çš„è°ƒç”¨æ–¹å¼
        function loadData() {
            const raw = localStorage.getItem('classBoardData');
            container.innerHTML = ''; // æ¸…ç©º
            if (!raw) {
                renderCard('time', '', '', true);
                renderCard('tag', '', 'æ¬¢è¿ä½¿ç”¨ï¼\nç‚¹å‡»æ­¤å¡ç‰‡å¯ä¿®æ”¹å†…å®¹ã€‚\nåˆ·æ–°é¡µé¢å†…å®¹ä¸ä¼šä¸¢å¤±ã€‚', true);
                return;
            }
            const data = JSON.parse(raw);
            if(data.title) titleElem.innerText = data.title;
            if(data.cards && data.cards.length > 0) {
                // æŒ‰é¡ºåº append
                data.cards.forEach(item => {
                    renderCard(item.type, item.subject, item.content, true);
                });
            }
        }

        function removeCard(btn) {
            // é˜»æ­¢å†’æ³¡å·²ç»é€šè¿‡ onclick ä½ç½®å¤„ç†äº†ï¼Œä½†ä¸ºäº†ä¿é™©
            event.stopPropagation();
            if(confirm('ç¡®å®šåˆ é™¤è¿™å¼ å¡ç‰‡å—ï¼Ÿ')) {
                btn.parentElement.remove();
                saveData();
            }
        }

        function updateTimeDisplays() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            const dateStr = now.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', weekday: 'long' });
            
            document.querySelectorAll('.card-time').forEach(card => {
                card.querySelector('.time-display').textContent = timeStr;
                card.querySelector('.date-display').textContent = dateStr;
            });
            document.getElementById('last-update').textContent = now.toLocaleTimeString();
        }

        // --- 4. æ¨¡æ€æ¡†äº¤äº’é€»è¾‘ ---

        // æ‰“å¼€â€œæ–°å¢â€æ¨¡æ€æ¡†
        function openAddModal() {
            editingCardElement = null; // æ ‡è®°ä¸ºæ–°å¢
            document.getElementById('modal-title').innerText = "æ·»åŠ æ–°å¡ç‰‡";
            document.getElementById('confirm-btn').innerText = "ç¡®è®¤æ·»åŠ ";
            document.getElementById('type-selector').style.display = 'grid'; // æ˜¾ç¤ºç±»å‹é€‰æ‹©
            
            // æ¸…ç©ºè¾“å…¥
            document.getElementById('hw-subject').value = '';
            document.getElementById('hw-content').value = '';
            document.getElementById('tag-content').value = '';
            
            selectType('hw'); // é»˜è®¤é€‰ä¸­ä½œä¸š
            modal.style.display = 'flex';
        }

        // æ‰“å¼€â€œç¼–è¾‘â€æ¨¡æ€æ¡†
        function openEditModal(element) {
            editingCardElement = element; // æ ‡è®°ä¸ºç¼–è¾‘
            document.getElementById('modal-title').innerText = "ç¼–è¾‘å¡ç‰‡";
            document.getElementById('confirm-btn').innerText = "ä¿å­˜ä¿®æ”¹";
            document.getElementById('type-selector').style.display = 'none'; // ç¼–è¾‘æ—¶ä¸èƒ½æ”¹ç±»å‹
            
            const type = element.dataset.type;
            currentType = type;
            selectType(type); // åˆ‡æ¢åˆ°å¯¹åº”è¾“å…¥ç•Œé¢

            // å¡«å……æ•°æ®
            if (type === 'hw') {
                document.getElementById('hw-subject').value = element.dataset.subject;
                document.getElementById('hw-content').value = element.dataset.content;
            } else if (type === 'tag') {
                document.getElementById('tag-content').value = element.dataset.content;
            }
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        // åˆ‡æ¢ç±»å‹ UI
        function selectType(type) {
            currentType = type;
            document.querySelectorAll('.modal-btn').forEach(btn => btn.classList.remove('active'));
            // æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®é«˜äº®
            const btnIndex = ['hw', 'tag', 'time'].indexOf(type);
            if(btnIndex >= 0 && document.querySelectorAll('.modal-btn')[btnIndex]) {
                document.querySelectorAll('.modal-btn')[btnIndex].classList.add('active');
            }
            
            document.querySelectorAll('.input-group').forEach(grp => grp.classList.remove('show'));
            document.getElementById(`input-${type}`).classList.add('show');
        }

        // ç¡®è®¤æŒ‰é’®é€»è¾‘ï¼ˆåŒºåˆ†æ–°å¢å’Œç¼–è¾‘ï¼‰
        function confirmAction() {
            let subject = '';
            let content = '';

            if (currentType === 'hw') {
                subject = document.getElementById('hw-subject').value || 'æœªå‘½å';
                content = document.getElementById('hw-content').value || 'æ— å†…å®¹';
            } else if (currentType === 'tag') {
                content = document.getElementById('tag-content').value || 'æ— å†…å®¹';
            }
            // time ç±»å‹ä¸éœ€è¦å†…å®¹

            if (editingCardElement) {
                // --- ç¼–è¾‘æ¨¡å¼ ---
                const card = editingCardElement;
                card.dataset.subject = subject;
                card.dataset.content = content;
                
                // æ›´æ–° UI ç±»åå’Œå†…å®¹
                let newClasses = 'card';
                let innerHTML = '';

                if (currentType === 'tag') {
                    newClasses += ' card-tag';
                    innerHTML = `<p>${content}</p><span class="delete-btn" onclick="removeCard(this)">âœ•</span>`;
                } else if (currentType === 'hw') {
                    newClasses += ' card-hw';
                    if (content.length > 50 || content.includes('\n')) newClasses += ' span-2-2';
                    innerHTML = `<div class="subject">${subject}</div><div class="content">${content.replace(/\n/g, '<br>')}</div><span class="delete-btn" onclick="removeCard(this)">âœ•</span>`;
                }
                
                card.className = newClasses;
                card.innerHTML = innerHTML;

            } else {
                // --- æ–°å¢æ¨¡å¼ ---
                renderCard(currentType, subject, content, false); // æ’åˆ°æœ€å‰
            }

            saveData(); // ä¿å­˜å˜åŠ¨
            closeModal();
        }

        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

    </script>
</body>
</html>